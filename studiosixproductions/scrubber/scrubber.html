<!DOCTYPE html>
<html>
	<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	 <script src="raphael.min.js"></script>
	 <script src="raphael.filter.js"></script>
	 <!-- // <script src="raphael.dropshadow.js"></script> -->
	 <style>
	 body{background: #000;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
   font-weight: 300;color:#fff;text-align: center;}
   h1,h2, h3{font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
   font-weight: 300;}
	 	path{z-index: 2;position: absolute;}
	 	#track{z-index: 0;}
	 	#scrubber-container{margin:0 auto;width:300px;}
	 	.dropshadow{
	 		background:#fff;
	 		color:#fff;
	 		filter: url(#dropshadow);
	 	}
	 </style>
	</head>
	<body>
		<div id="scrubber-container"></div>
		<h1>Velocity : <span id="velocity">0</span></h1>
<script>
(function(window, document, undefined){
	
	function isTouchDevice() {
		var el = document.createElement('div');
		el.setAttribute('ongesturestart', 'return;');
		return typeof el.ongesturestart === "function";
	}

	window.onload = function() {
		var canvasWidth = 260;
		var canvasHeight = 260;
		var R = 95;
		var strokeWidth = 60;
		var trackWidth = strokeWidth + 5;
		var paper = Raphael("scrubber-container", canvasWidth, canvasHeight);
		paper.addDropShadowFilter(2, -2, -2, 0.5);

		var background = paper.image("center-bg.png", trackWidth, trackWidth, canvasWidth / 2, canvasHeight / 2);
		
		//custom attributes
	    paper.customAttributes.arc = function (value, total, R) {
	        var alpha = value == 360 ? 359 : 360 / total * value,
	            a = (90 - alpha) * Math.PI / 180,
	            x = (canvasWidth / 2) + R * Math.cos(a),
	            y = (canvasHeight / 2) - R * Math.sin(a),
	            path;

			path = [["M", canvasWidth / 2, canvasHeight / 2 - R], ["A", R, R, 0, +(alpha > 180), 1, x, y]];	

	        return {path: path};
	    };

		var months = [
			'January',
			'February',
			'March',
			'April',
			'May',
			'June',
			'July',
			'August',
			'September',
			'October',
			'November',
			'December'
		];
		
		//Paths
	    var track = paper.path().attr({stroke: '#FFFFFF', 'stroke-width': trackWidth, 'stroke-linecap' : 'round'}).animate({arc: [360, 360, R]});
		// track.node.setAttribute("class", "dropshadow");

	    var purple = paper.path().attr({stroke: '#9E00FD', 'stroke-width': strokeWidth, 'stroke-linecap' : 'round'}).animate({arc: [90, 360, R]}); 
	   	var pink = paper.path().attr({stroke: '#D300EB', 'stroke-width': strokeWidth, 'stroke-linecap' : 'round'}).animate({arc: [45, 360, R]}); 

	   	//Text
	   	var canvasPosition = $('#scrubber-container svg').offset();
	   	var textOffset = 15;
	    var centerX = canvasPosition.left + (canvasWidth / 2);
		var centerY = canvasPosition.top + (canvasHeight / 2);
	    var d = new Date();
	    var hours = d.getHours();
	    var minutes = d.getMinutes();
	
	   	var date = paper.text(canvasWidth / 2, (canvasHeight / 2) - textOffset, d.getDate() + ' '+ months[d.getMonth()] + ' '+ d.getFullYear() + "\n")
        .attr({
        	'fill' : '#ffffff',
        	'font-size' : '12px',
        	'cursor' : 'pointer'
        });
        var time = paper.text(canvasWidth / 2, (canvasHeight / 2) + textOffset, hours + ':' + minutes).attr({
        	'fill' : '#ffffff',
        	'font-size' : '38px',
        	'cursor' : 'pointer'
        });

	    var angle = 0;
    	var lastX = 0;
		var lastTime = (new Date()).getTime();
		var distance = 0;
	    
	   	//setup IDs
	    track.node.id = "track";
	    purple.node.id = "purple";
	    pink.node.id = "pink";

	    //keep track of the velocity
	    var trackVelocity = function(x, y){
	    	var t = (new Date()).getTime();

			if(lastX > 0){
				velocity =  (x - lastX) / (t - lastTime);
			}

			lastX = x;
			lastTime = t;
			velocity = velocity < 0 ? Math.floor(-velocity * 100) : Math.floor(velocity * 100);

			//FOR DEMO ~~~~~~~~~~~~~~~~~~
			$('#velocity').text(velocity);
	    };

	    //draw the arc based on mouse movement
	    var drawArc = function(el, x, y){
	    	var posX = x;
			var posY = y;
			var deltaX = posX - centerX;
			var deltaY = posY - centerY;		

			angle = (Math.atan2(deltaY, deltaX) * 180 / Math.PI) + 90;

			var val = (angle < 0) ? 360 + angle : angle;

			console.log('x', posX,'y',posY, 'angle', angle, 'value', val)
			
			if(val == 0 || angle == 359) return;

			el.animate({arc: [val, 360, R]});
	    };

	    var updateTime = function(){
	    	//time
			if(minutes < 60){
				minutes++;
			}
			else{
				hours++;
				minutes = 0;
			}

			time.attr({text: hours + ':' + minutes});
	    };

	    var minimize = function(){
	    	//DUMMY CODE
	    	clearInterval(interval);
	    	//END DUMMY CODE

	    	R = 65;
	    	track.attr({stroke: '#FFFFFF', 'stroke-width': 15}).animate({arc: [359, 360, R]});
	   	 	purple.attr({stroke: '#9E00FD', 'stroke-width': 10, 'stroke-linecap' : 'round'}).animate({arc: [purple.attrs.arc[0], 360, R]}); 
	   		pink.attr({stroke: '#D300EB', 'stroke-width': 10, 'stroke-linecap' : 'round'}).animate({arc: [pink.attrs.arc[0], 360, R]});

	   		//DUMMY CODE
	    	dummyInterval();
	    	//END DUMMY CODE
	    };

	    var maximize = function(){
	    	//DUMMY CODE
	    	clearInterval(interval);
	    	//END DUMMY CODE
	    	R = 95;	
	    	track.attr({stroke: '#FFFFFF', 'stroke-width': trackWidth}).animate({arc: [359, 360, R]});
	   	 	purple.attr({stroke: '#9E00FD', 'stroke-width': strokeWidth, 'stroke-linecap' : 'round'}).animate({arc: [purple.attrs.arc[0], 360, R]}); 
	   		pink.attr({stroke: '#D300EB', 'stroke-width': strokeWidth, 'stroke-linecap' : 'round'}).animate({arc: [pink.attrs.arc[0], 360, R]});

	   		//DUMMY CODE
	    	dummyInterval();
	    	//END DUMMY CODE
	    };

        //Events
        if(isTouchDevice()){
        	var handleTouchMove = function(e){
        		e.preventDefault();
			    var touch = e.touches[0];
			    var x = touch.pageX;
			    var y = touch.pageY;
			    updateTime();
			    trackVelocity(x, y);
        	};

			document.getElementById('track').addEventListener('touchmove', handleTouchMove, false);
			document.getElementById('pink').addEventListener('touchmove', handleTouchMove, false);
			document.getElementById('purple').addEventListener('touchmove', handleTouchMove, false);
		}
		else{
			var handleDrag = function(dx, dy, x, y, e){
			    updateTime();
			    trackVelocity(x, y);
			};

			//set the drag event for each path object
			paper.set(track, purple, pink).drag(handleDrag);
		}

		$('text').on('click touchstart', function(){
			var el = $(this);
			if(el.attr('minimized')){
				el.removeAttr('minimized');
				maximize();
			}
			else{
				el.attr('minimized', true);
				minimize();
			}
		});

		//DUMMY DATA~~~~~~~~~~~~~~~~~
		var val = 90;
		var interval;
		var dummyInterval = function(){
			interval = setInterval(function(){
				val += Math.random() * 25;
				if(val > 300) clearInterval(interval);
				purple.animate({arc: [val, 360, R]}, 500, "slide");
			}, 3000);
		}

		dummyInterval();
	};
             
})(window, document);
</script>
	</body>
</html>