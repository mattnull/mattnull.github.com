<!DOCTYPE html>
<html>
	<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	 <script src="raphael.min.js"></script>
	 <style>
	 body{background: #000000;font-family: Helvetica;color:#fff;}
	 	#scrubber{

	 	}
	 	path{z-index: 2;position: absolute;}
	 	#track{z-index: 0;}
	 </style>
	</head>
	<body>
		<div id="scrubber"></div>
<script>
(function(window, document, undefined){
	function isTouchDevice() {
		var el = document.createElement('div');
		el.setAttribute('ongesturestart', 'return;');
		return typeof el.ongesturestart === "function";
	}

	window.onload = function () {

		var canvasWidth = 300;
		var canvasHeight = 300;
		var months = [
			'January',
			'February',
			'March',
			'April',
			'May',
			'June',
			'July',
			'August',
			'September',
			'October',
			'November',
			'December'
		];

	    var strokeWidth = 70;
	    var paper = Raphael("scrubber", canvasWidth, canvasHeight),
	        R = 100;
	    
	    paper.customAttributes.arc = function (value, total, R) {
	        var alpha = 360 / total * value,
	            a = (90 - alpha) * Math.PI / 180,
	            x = (canvasWidth / 2) + R * Math.cos(a),
	            y = (canvasHeight / 2) - R * Math.sin(a),
	            path;

	        if (total == value) {
	            path = [["M", canvasWidth / 2, canvasHeight / 2 - R], ["A", R, R, 0, 1, 1, canvasWidth / 2, canvasHeight / 2 - R]];
	        } else {
	            path = [["M", canvasWidth / 2, canvasHeight / 2 - R], ["A", R, R, 0, +(alpha > 180), 1, x, y]];
	        }
	    
	        return {path: path};
	    };

	    var track = paper.path().attr({stroke: "#FFFFFF", "stroke-width": strokeWidth}).animate({arc: [359, 360, R]});
	    var purple = paper.path().attr({stroke: "#9E00FD", "stroke-width": strokeWidth}).animate({arc: [180, 360, R]}); 
	   	var pink = paper.path().attr({stroke: "#D300EB", "stroke-width": strokeWidth}).animate({arc: [130, 360, R]}); 
	    var canvasPosition = $('#scrubber svg').offset();
	    var centerX = (canvasWidth - canvasPosition.left) / 2;
		var centerY = (canvasHeight + canvasPosition.top) / 2;
	    var angle = 0;
	    var d = new Date();
	    var hours = d.getHours();
	    var minutes = d.getMinutes();

	    var draw = function(el, x, y){
	    	var posX = x;
			var posY = y;
			var deltaX = posX - centerX;
			var deltaY = posY - centerY;

			angle = (Math.atan2(deltaY, deltaX) * 180 / Math.PI) + 90;

			var val = (angle < 0) ? 360 + angle : angle;

			console.log('x', posX,'y',posY, 'angle', angle, 'value', val)
			
			if(val == 0 || angle == 359) return;
			
			el.animate({arc: [val, 360, R]});
			
			//time
			if(minutes < 60){
				minutes++;
			}
			else{
				hours++;
				minutes = 0;
			}

			time.attr({text: hours + ':' + minutes});
	    };

	    //setup IDs
	    track.node.id = "track";
	    purple.node.id = "purple"
	    pink.node.id = "pink"

        var start = function (x, y, e) {
			draw(this, e.clientX, e.clientY);
        },
        move = function (dx, dy, x, y, e) {
			draw(this, e.clientX, e.clientY);
        },
        up = function (dx, dy) {};

        var date = paper.text(centerX, centerY - 20, d.getDate() + ' '+ months[d.getMonth()] + ' '+ d.getFullYear() + "\n")
        .attr({
        	'fill' : '#ffffff',
        	'font-size' : '14px'
        });

        var time = paper.text(centerX, centerY + 15, hours + ':' + minutes).attr({
        	'fill' : '#ffffff',
        	'font-size' : '40px'
        });

        if(isTouchDevice()){
			document.getElementById('purple').addEventListener('touchmove', function(event) {
			    event.preventDefault();
			    var touch = event.touches[0];
			    console.log("Touch x:" + touch.pageX + ", y:" + touch.pageY);
			    draw(purple, touch.pageX, touch.pageY);
			}, false);

			document.getElementById('pink').addEventListener('touchmove', function(event) {
			    event.preventDefault();
			    var touch = event.touches[0];
			    console.log("Touch x:" + touch.pageX + ", y:" + touch.pageY);
			    draw(pink, touch.pageX, touch.pageY);
			}, false);
		}
		else{
			purple.drag(move, start, up);
			pink.drag(move, start, up);
		}

        // $('#scrubber').append(t);
        // $(window).on('mousemove', function(e){
        // 	console.log(e.pageX, e.pageY)
        // })
	};
             
})(window, document);
</script>
	</body>
</html>